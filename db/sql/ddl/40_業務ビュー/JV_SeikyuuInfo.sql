CREATE VIEW JV_SeikyuuInfo AS
/* 未請求 */
SELECT
C.syono,
C.skno,
C.seikyuusyubetu,
C.saisateikbn,
C.siboukaritrkymd,
C.sibouymd,
C.geninkbn,
'0' AS siinkbn,
D.kykymd,
C.kyknmkj,
C.kyknmkn,
C.hhknnmkj,
C.hhknnmkn,
C.hhknseiymd,
C.hhknsei,
E.sbuktnin,
F.uktkbn,
F.uktnmkj,
F.uktseiymd,
F.uktbnwari,
D.syouhncd,
G.initsbjiyensitihsytkhukaumu,
H.ttdktyuuinaiyou1,
H.ttdktyuuinaiyou2,
H.ttdktyuuinaiyou3,
H.ttdktyuuikbn1,
H.ttdktyuuikbnhsknaiyou1,
H.ttdktyuuikbnsetymd1,
H.ttdktyuuikbn2,
H.ttdktyuuikbnhsknaiyou2,
H.ttdktyuuikbnsetymd2,
H.ttdktyuuikbn3,
H.ttdktyuuikbnhsknaiyou3,
H.ttdktyuuikbnsetymd3,
H.ttdktyuuikbn4,
H.ttdktyuuikbnhsknaiyou4,
H.ttdktyuuikbnsetymd4,
H.ttdktyuuikbn5,
H.ttdktyuuikbnhsknaiyou5,
H.ttdktyuuikbnsetymd5,
'0' AS seikyuusyakbn,
'' AS seikyuusyanmkn,
'' AS seikyuusyanmkj,
'' AS tsinyno,
'' AS tsinadr1kj,
'' AS tsinadr2kj,
'' AS tsinadr3kj,
CAST(NULL AS CHAR(8)) AS syoruiukeymd,
CAST(NULL AS CHAR(8)) AS hubikanryouymd,
'0' AS shrkekkakbn,
'0' AS saigaihigaitoukbn,
CAST(NULL AS CHAR(8)) AS shrsyoriymd,
CAST(NULL AS CHAR(8)) AS tyakkinymd,
CAST(NULL AS DECIMAL(13)) AS shrgkkei,
CAST(NULL AS CHAR(3)) AS shrgkkei$,
'0' AS shrtuukasyu,
CAST(NULL AS DECIMAL(7,4)) AS shrkwsrate,
CAST(NULL AS CHAR(8)) AS shrkwsratekjnymd,
CAST(NULL AS DECIMAL(7,4)) AS gaikaknsnkwsrate,
CAST(NULL AS CHAR(8)) AS gaikaknsnkwsratekjymd,
CAST(NULL AS DECIMAL(13)) AS hokenkngkgoukei,
CAST(NULL AS CHAR(3)) AS hokenkngkgoukei$,
CAST(NULL AS DECIMAL(13)) AS haitoukin,
CAST(NULL AS CHAR(3)) AS haitoukin$,
CAST(NULL AS DECIMAL(13)) AS sonotahaitoukin,
CAST(NULL AS CHAR(3)) AS sonotahaitoukin$,
CAST(NULL AS DECIMAL(13)) AS misyuup,
CAST(NULL AS CHAR(3)) AS misyuup$,
CAST(NULL AS DECIMAL(13)) AS mikeikap,
CAST(NULL AS CHAR(3)) AS mikeikap$,
CAST(NULL AS DECIMAL(13)) AS zennouseisankgk,
CAST(NULL AS CHAR(3)) AS zennouseisankgk$,
CAST(NULL AS DECIMAL(13)) AS azukarikingk,
CAST(NULL AS CHAR(3)) AS azukarikingk$,
CAST(NULL AS DECIMAL(13)) AS krkgk,
CAST(NULL AS CHAR(3)) AS krkgk$,
CAST(NULL AS DECIMAL(13)) AS shrtienrsk,
CAST(NULL AS CHAR(3)) AS shrtienrsk$,
CAST(NULL AS DECIMAL(13)) AS yenshrgk,
CAST(NULL AS CHAR(3)) AS yenshrgk$,
CAST(NULL AS DECIMAL(13)) AS yenhkgkgoukei,
CAST(NULL AS CHAR(3)) AS yenhkgkgoukei$,
CAST(NULL AS DECIMAL(13)) AS yenkahaitoukin,
CAST(NULL AS CHAR(3)) AS yenkahaitoukin$,
CAST(NULL AS DECIMAL(13)) AS yenkasonotahaitoukin,
CAST(NULL AS CHAR(3)) AS yenkasonotahaitoukin$,
CAST(NULL AS DECIMAL(13)) AS yenkamisyuup,
CAST(NULL AS CHAR(3)) AS yenkamisyuup$,
CAST(NULL AS DECIMAL(13)) AS yenkamikeikap,
CAST(NULL AS CHAR(3)) AS yenkamikeikap$,
CAST(NULL AS DECIMAL(13)) AS yenkazennouseisankgk,
CAST(NULL AS CHAR(3)) AS yenkazennouseisankgk$,
CAST(NULL AS DECIMAL(13)) AS yenkaazukarikingk,
CAST(NULL AS CHAR(3)) AS yenkaazukarikingk$,
CAST(NULL AS DECIMAL(13)) AS yenkakrkgk,
CAST(NULL AS CHAR(3)) AS yenkakrkgk$,
CAST(NULL AS DECIMAL(13)) AS yenshrtienrsk,
CAST(NULL AS CHAR(3)) AS yenshrtienrsk$,
CAST(NULL AS DECIMAL(13)) AS zitkazukarikingksiteituuka,
CAST(NULL AS CHAR(3)) AS zitkazukarikingksiteituuka$,
CAST(NULL AS DECIMAL(13)) AS zitkazukarikingkyen,
CAST(NULL AS CHAR(3)) AS zitkazukarikingkyen$,
CAST(NULL AS DECIMAL(13)) AS gaikaknsntkgk,
CAST(NULL AS CHAR(3)) AS gaikaknsntkgk$,
CAST(NULL AS DECIMAL(13)) AS gaikaknsnkekkakgk,
CAST(NULL AS CHAR(3)) AS gaikaknsnkekkakgk$,
CAST(NULL AS DECIMAL(13)) AS yenkaknsntkgk,
CAST(NULL AS CHAR(3)) AS yenkaknsntkgk$,
CAST(NULL AS DECIMAL(13)) AS yenkaknsnkekkakgk,
CAST(NULL AS CHAR(3)) AS yenkaknsnkekkakgk$,
'0' AS kyktuukasyu,
'0' AS inputshrhousiteikbn,
CAST(NULL AS DECIMAL(7,4)) AS zeimukwsrate,
CAST(NULL AS CHAR(3)) AS zeimukwsratekjnymd,
'0' AS zeitratkikbn,
'' AS kousinsyaId,    /* 更新者ＩＤ     */
'' AS kousinTime,    /* 更新時間       */
'' AS kousinKinou,    /* 更新機能       */
0 AS version        /* バージョン     */
FROM
(SELECT
    A.syono,
    A.skno,
    B.seikyuusyubetu,
    B.saisateikbn,
    B.siboukaritrkymd,
    A.sibouymd,
    A.geninkbn,
    B.kyknmkj,
    B.kyknmkn,
    B.hhknnmkj,
    B.hhknnmkn,
    B.hhknseiymd,
    B.hhknsei
FROM
    JT_SibouKariuketsuke A 
JOIN JT_SkKihon B 
ON A.syono = B.syono AND A.skno = B.skno AND B.seikyuusyubetu = '6' AND A.torikesiflg = '0'
WHERE
    NOT EXISTS
(SELECT
    S.syono
FROM
    JT_SkKihon SKK JOIN JT_Sk S ON SKK.seikyuusyubetu = '2' AND SKK.syono = S.syono AND  SKK.skno = S.skno
WHERE
    A.syono = S.syono
)
) C
LEFT OUTER JOIN IT_KykSyouhn D
ON C.syono = D.syono AND D.syutkkbn = '1'
LEFT OUTER JOIN IT_KykKihon E
ON C.syono = E.syono
LEFT OUTER JOIN IT_KykUkt F
ON C.syono = F.syono AND F.uktsyukbn = '1' AND F.uktsyurenno = 1
LEFT OUTER JOIN IT_KykSonotaTkyk G
ON C.syono = G.syono
LEFT OUTER JOIN IT_KhTtdkTyuui H
ON C.syono = H.syono
UNION ALL
/* 受付中、支払済、診断書料支払 */
SELECT 
C.syono, 
C.skno, 
C.seikyuusyubetu, 
C.saisateikbn, 
C.siboukaritrkymd,
I.sibouymd,
'0' AS geninkbn,
C.siinkbn, 
E.kykymd, 
C.kyknmkj, 
C.kyknmkn, 
C.hhknnmkj, 
C.hhknnmkn, 
C.hhknseiymd, 
C.hhknsei, 
F.sbuktnin, 
G.uktkbn, 
G.uktnmkj, 
G.uktseiymd, 
G.uktbnwari, 
E.syouhncd, 
H.initsbjiyensitihsytkhukaumu,
J.ttdktyuuinaiyou1,
J.ttdktyuuinaiyou2,
J.ttdktyuuinaiyou3,
J.ttdktyuuikbn1,
J.ttdktyuuikbnhsknaiyou1,
J.ttdktyuuikbnsetymd1,
J.ttdktyuuikbn2,
J.ttdktyuuikbnhsknaiyou2,
J.ttdktyuuikbnsetymd2,
J.ttdktyuuikbn3,
J.ttdktyuuikbnhsknaiyou3,
J.ttdktyuuikbnsetymd3,
J.ttdktyuuikbn4,
J.ttdktyuuikbnhsknaiyou4,
J.ttdktyuuikbnsetymd4,
J.ttdktyuuikbn5,
J.ttdktyuuikbnhsknaiyou5,
J.ttdktyuuikbnsetymd5,
C.seikyuusyakbn,
C.seikyuusyanmkn,
C.seikyuusyanmkj,
C.tsinyno,
C.tsinadr1kj,
C.tsinadr2kj,
C.tsinadr3kj,
C.syoruiukeymd,
C.hubikanryouymd,
C.shrkekkakbn,
C.saigaihigaitoukbn,
D.shrsyoriymd,
D.tyakkinymd,
D.shrgkkei,
D.shrgkkei$,
C.shrtuukasyu,
C.shrkwsrate,
C.shrkwsratekjnymd,
C.gaikaknsnkwsrate,
C.gaikaknsnkwsratekjymd,
C.hokenkngkgoukei,
C.hokenkngkgoukei$,
C.haitoukin,
C.haitoukin$,
C.sonotahaitoukin,
C.sonotahaitoukin$,
C.misyuup,
C.misyuup$,
C.mikeikap,
C.mikeikap$,
C.zennouseisankgk,
C.zennouseisankgk$,
C.azukarikingk,
C.azukarikingk$,
C.krkgk,
C.krkgk$,
C.shrtienrsk,
C.shrtienrsk$,
C.yenshrgk,
C.yenshrgk$,
C.yenhkgkgoukei,
C.yenhkgkgoukei$,
C.yenkahaitoukin,
C.yenkahaitoukin$,
C.yenkasonotahaitoukin,
C.yenkasonotahaitoukin$,
C.yenkamisyuup,
C.yenkamisyuup$,
C.yenkamikeikap,
C.yenkamikeikap$,
C.yenkazennouseisankgk,
C.yenkazennouseisankgk$,
C.yenkaazukarikingk,
C.yenkaazukarikingk$,
C.yenkakrkgk,
C.yenkakrkgk$,
C.yenshrtienrsk,
C.yenshrtienrsk$,
C.zitkazukarikingksiteituuka,
C.zitkazukarikingksiteituuka$,
C.zitkazukarikingkyen,
C.zitkazukarikingkyen$,
C.gaikaknsntkgk,
C.gaikaknsntkgk$,
C.gaikaknsnkekkakgk,
C.gaikaknsnkekkakgk$,
C.yenkaknsntkgk,
C.yenkaknsntkgk$,
C.yenkaknsnkekkakgk,
C.yenkaknsnkekkakgk$,
C.kyktuukasyu,
C.inputshrhousiteikbn,
C.zeimukwsrate,
C.zeimukwsratekjnymd,
D.zeitratkikbn,
'' AS kousinsyaId,    /* 更新者ＩＤ     */
'' AS kousinTime,    /* 更新時間       */
'' AS kousinKinou,    /* 更新機能       */
0 AS version        /* バージョン     */
FROM 
(SELECT
    A.syono,
    A.skno,
    B.seikyuurirekino,
    A.seikyuusyubetu,
    A.saisateikbn,
    A.siboukaritrkymd,
    B.siinkbn,
    A.kyknmkj,
    A.kyknmkn,
    A.hhknnmkj,
    A.hhknnmkn,
    A.hhknseiymd,
    A.hhknsei,
    B.seikyuusyakbn,
    B.seikyuusyanmkn,
    B.seikyuusyanmkj,
    B.tsinyno,
    B.tsinadr1kj,
    B.tsinadr2kj,
    B.tsinadr3kj,
    B.syoruiukeymd,
    B.hubikanryouymd,
    A.shrkekkakbn,
    A.saigaihigaitoukbn,
    B.shrtuukasyu,
    B.shrkwsrate,
    B.shrkwsratekjnymd,
    B.gaikaknsnkwsrate,
    B.gaikaknsnkwsratekjymd,
    B.hokenkngkgoukei,
    B.hokenkngkgoukei$,
    B.haitoukin,
    B.haitoukin$,
    B.sonotahaitoukin,
    B.sonotahaitoukin$,
    B.misyuup,
    B.misyuup$,
    B.mikeikap,
    B.mikeikap$,
    B.zennouseisankgk,
    B.zennouseisankgk$,
    B.azukarikingk,
    B.azukarikingk$,
    B.krkgk,
    B.krkgk$,
    B.shrtienrsk,
    B.shrtienrsk$,
    B.yenshrgk,
    B.yenshrgk$,
    B.yenhkgkgoukei,
    B.yenhkgkgoukei$,
    B.yenkahaitoukin,
    B.yenkahaitoukin$,
    B.yenkasonotahaitoukin,
    B.yenkasonotahaitoukin$,
    B.yenkamisyuup,
    B.yenkamisyuup$,
    B.yenkamikeikap,
    B.yenkamikeikap$,
    B.yenkazennouseisankgk,
    B.yenkazennouseisankgk$,
    B.yenkaazukarikingk,
    B.yenkaazukarikingk$,
    B.yenkakrkgk,
    B.yenkakrkgk$,
    B.yenshrtienrsk,
    B.yenshrtienrsk$,
    B.zitkazukarikingksiteituuka,
    B.zitkazukarikingksiteituuka$,
    B.zitkazukarikingkyen,
    B.zitkazukarikingkyen$,
    B.gaikaknsntkgk,
    B.gaikaknsntkgk$,
    B.gaikaknsnkekkakgk,
    B.gaikaknsnkekkakgk$,
    B.yenkaknsntkgk,
    B.yenkaknsntkgk$,
    B.yenkaknsnkekkakgk,
    B.yenkaknsnkekkakgk$,
    B.kyktuukasyu,
    B.inputshrhousiteikbn,
    B.zeimukwsrate,
    B.zeimukwsratekjnymd
FROM
    JT_SkKihon A 
JOIN JT_Sk B 
ON A.syono = B.syono AND A.skno = b.skno AND (A.seikyuusyubetu = '2' OR A.seikyuusyubetu = '7')
WHERE
    B.seikyuurirekino =
(SELECT
    MAX(seikyuurirekino)
FROM
    JT_Sk S
WHERE
    B.syono = S.syono AND
    B.skno = S.skno
)
) C
LEFT OUTER JOIN JT_SiRireki D 
ON C.syono = D.syono AND C.skno = D.skno AND C.seikyuurirekino = D.seikyuurirekino
LEFT OUTER JOIN IT_KykSyouhn E
ON C.syono = E.syono AND E.syutkkbn = '1'
LEFT OUTER JOIN IT_KykKihon F
ON C.syono = F.syono
LEFT OUTER JOIN IT_KykUkt G
ON C.syono = G.syono AND G.uktsyukbn = '1' AND G.uktsyurenno = 1
LEFT OUTER JOIN IT_KykSonotaTkyk H
ON C.syono = H.syono
LEFT OUTER JOIN JT_SkJiyuu I
ON C.syono = I.syono AND C.skno = I.skno AND C.seikyuurirekino = I.seikyuurirekino
LEFT OUTER JOIN IT_KhTtdkTyuui J
ON C.syono = J.syono
;